{"version":3,"file":"index.min.js","sources":["../src/index.js"],"sourcesContent":["/* eslint-disable */\nimport React from \"react\";\nimport { BehaviorSubject, pipe, Subject, isObservable, of } from \"rxjs\";\nimport { map, takeUntil, mergeAll } from \"rxjs/operators\";\n\nfunction internalizeKey(key) {\n  return function (val) {\n    return { [key]: val };\n  };\n}\n\nfunction parseInput(obj, streams, props) {\n  var keys = Object.keys(obj);\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var val = obj[key];\n    if (isObservable(val)) {\n      var newObs = val.pipe(map(internalizeKey(key)));\n      streams.push(newObs);\n    } else {\n      props[key] = val;\n    }\n  }\n}\n\nfunction isShallowEqual(v, o) {\n  var k1 = Object.keys(v);\n  var k2 = Object.keys(o);\n  if (k1.length !== k2.length) {\n    return false;\n  }\n  for (var i = 0; i < k1.length; i++) {\n    if (o[k1[i]] !== v[k2[i]]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction mergeObjTo(ob1, ob2) {\n  var keys = Object.keys(ob2);\n  for (var i = 0; i < keys.length; i++) {\n    ob1[keys[i]] = ob2[keys[i]];\n  }\n}\n\nfunction init(component, controller) {\n  var onDestroyCallback;\n  var intercept;\n\n  function updateData(obj) {\n    mergeObjTo(component.resolved, obj);\n  }\n\n  function rerender() {\n    component.force$.next();\n  }\n\n  function onError(e) {\n    console.error(e);\n  }\n\n  function finalize() {\n    if (onDestroyCallback) {\n      onDestroyCallback();\n    }\n  }\n\n  controller({\n    props$: component.props$,\n    onDestroy: function (fn) {\n      component.onDestroyCallback = fn;\n    },\n    resolve: function (strObj) {\n      parseInput(strObj || {}, component.streams, component.resolved);\n    },\n    setIntercept: function (i) {\n      intercept = i;\n    },\n  });\n\n  var pipes = component.intercept\n    ? pipe(mergeAll(), takeUntil(component.destroyed$), map(updateData), intercept)\n    : pipe(mergeAll(), takeUntil(component.destroyed$), map(updateData));\n\n  of.apply(null, [component.props$].concat(component.streams))\n    .pipe(pipes)\n    .subscribe(rerender, onError, finalize);\n}\n\nfunction xstream(controller, Wrapped) {\n  function StreamC() {\n    this.props$ = new BehaviorSubject(arguments[0]);\n    this.force$ = new Subject();\n    this.destroyed$ = new Subject();\n    this.streams = [];\n    this.resolved = {};\n\n    init(this, controller);\n\n    React.Component.apply(this, arguments);\n  }\n\n  StreamC.prototype = Object.create(React.Component.prototype);\n\n  var sProto = StreamC.prototype;\n\n  sProto.constructor = StreamC;\n\n  sProto.componentDidMount = function () {\n    var self = this;\n    self.force$.pipe(takeUntil(self.destroyed$)).subscribe(function () {\n      self.forceUpdate();\n    });\n  };\n\n  sProto.componentWillUnmount = function () {\n    this.destroyed$.next();\n  };\n\n  sProto.shouldComponentUpdate = function (nextProps) {\n    if (!isShallowEqual(this.props, nextProps)) {\n      this.props$.next(nextProps);\n    }\n    return false;\n  };\n\n  sProto.render = function () {\n    return React.createElement(Wrapped, this.resolved);\n  };\n\n  return StreamC;\n}\n\nexport default xstream;\n"],"names":["parseInput","obj","streams","props","keys","Object","i","length","newObs","key","val","isObservable","pipe","map","internalizeKey","push","init","component","controller","intercept","updateData","ob1","ob2","mergeObjTo","resolved","props$","onDestroy","fn","onDestroyCallback","resolve","strObj","setIntercept","pipes","mergeAll","takeUntil","destroyed$","of","apply","concat","subscribe","force$","next","e","console","error","Wrapped","StreamC","this","BehaviorSubject","arguments","Subject","React","Component","sProto","prototype","create","constructor","componentDidMount","self","forceUpdate","componentWillUnmount","shouldComponentUpdate","nextProps","v","o","k1","k2","isShallowEqual","render","createElement"],"mappings":"qKAWA,SAASA,EAAWC,EAAKC,EAASC,GAEhC,IADA,IAAIC,EAAOC,OAAOD,KAAKH,GACdK,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAAK,CACpC,IAGME,EAHFC,EAAML,EAAKE,GACXI,EAAMT,EAAIQ,GACVE,eAAaD,IACXF,EAASE,EAAIE,KAAKC,MAZ5B,SAAwBJ,GACtB,OAAO,SAAUC,GACf,MAAO,EAAGD,GAAMC,IAUYI,CAAeL,KACzCP,EAAQa,KAAKP,IAEbL,EAAMM,GAAOC,GA0BnB,SAASM,EAAKC,EAAWC,GAEvB,IAAIC,EAEJ,SAASC,EAAWnB,IAXtB,SAAoBoB,EAAKC,GAEvB,IADA,IAAIlB,EAAOC,OAAOD,KAAKkB,GACdhB,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAC/Be,EAAIjB,EAAKE,IAAMgB,EAAIlB,EAAKE,IASxBiB,CAAWN,EAAUO,SAAUvB,GAiBjCiB,EAAW,CACTO,OAAQR,EAAUQ,OAClBC,UAAW,SAAUC,GACnBV,EAAUW,kBAAoBD,GAEhCE,QAAS,SAAUC,GACjB9B,EAAW8B,GAAU,GAAIb,EAAUf,QAASe,EAAUO,WAExDO,aAAc,SAAUzB,GACtBa,EAAYb,KAIZ0B,EAAQf,EAAUE,UAClBP,OAAKqB,aAAYC,YAAUjB,EAAUkB,YAAatB,MAAIO,GAAaD,GACnEP,OAAKqB,aAAYC,YAAUjB,EAAUkB,YAAatB,MAAIO,IAE1DgB,KAAGC,MAAM,KAAM,CAACpB,EAAUQ,QAAQa,OAAOrB,EAAUf,UAChDU,KAAKoB,GACLO,UAjCH,WACEtB,EAAUuB,OAAOC,QAGnB,SAAiBC,GACfC,QAAQC,MAAMF,IAGhB,wBA4BF,SAAiBxB,EAAY2B,GAC3B,SAASC,IACPC,KAAKtB,OAAS,IAAIuB,kBAAgBC,UAAU,IAC5CF,KAAKP,OAAS,IAAIU,UAClBH,KAAKZ,WAAa,IAAIe,UACtBH,KAAK7C,QAAU,GACf6C,KAAKvB,SAAW,GAEhBR,EAAK+B,KAAM7B,GAEXiC,UAAMC,UAAUf,MAAMU,KAAME,WAK9B,IAAII,EAFJP,EAAQQ,UAAYjD,OAAOkD,OAAOJ,UAAMC,UAAUE,WA4BlD,OAxBAD,EAAOG,YAAcV,EAErBO,EAAOI,kBAAoB,WACzB,IAAIC,EAAOX,KACXW,EAAKlB,OAAO5B,KAAKsB,YAAUwB,EAAKvB,aAAaI,UAAU,WACrDmB,EAAKC,iBAITN,EAAOO,qBAAuB,WAC5Bb,KAAKZ,WAAWM,QAGlBY,EAAOQ,sBAAwB,SAAUC,GAIvC,OAnGJ,SAAwBC,EAAGC,GACzB,IAAIC,EAAK5D,OAAOD,KAAK2D,GACjBG,EAAK7D,OAAOD,KAAK4D,GACrB,GAAIC,EAAG1D,SAAW2D,EAAG3D,OAArB,CAGA,IAAK,IAAID,EAAI,EAAGA,EAAI2D,EAAG1D,OAAQD,IAC7B,GAAI0D,EAAEC,EAAG3D,MAAQyD,EAAEG,EAAG5D,IACpB,OAGJ,OAAO,GAqFA6D,CAAepB,KAAK5C,MAAO2D,IAC9Bf,KAAKtB,OAAOgB,KAAKqB,IAEZ,GAGTT,EAAOe,OAAS,WACd,OAAOjB,UAAMkB,cAAcxB,EAASE,KAAKvB,WAGpCsB"}