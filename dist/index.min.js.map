{"version":3,"file":"index.min.js","sources":["../src/index.js"],"sourcesContent":["import * as React from \"react\";\nimport { BehaviorSubject, merge, pipe, Subject, isObservable } from \"rxjs\";\nimport { map, takeUntil } from \"rxjs/operators\";\n\nfunction toStreamArr(streamObj) {\n  var props = {};\n  var streamProps = [];\n  Object.keys(streamObj)\n    .map(function (key) {\n      return { key, val: streamObj[key] };\n    })\n    .forEach(function (x) {\n      if (isObservable(x.val.isObservable)) {\n        streamProps.push(\n          x.val.pipe(\n            map(function (y) {\n              return { [x.key]: y };\n            })\n          )\n        );\n      } else {\n        props[x.key] = x.val;\n      }\n    });\n  return { props: props, streamProps: streamProps };\n}\n\nfunction isShallowEqual(v, o) {\n  var k1 = Object.keys(v);\n  var k2 = Object.keys(o);\n  if (k1.length !== k2.length) {\n    return false;\n  }\n  for (var i = 0; i < k1.length; i++) {\n    if (o[k1[i]] !== v[k2[i]]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction rx(controller) {\n  var force$ = new Subject();\n  var props$ = new BehaviorSubject({});\n  var destroyed$ = new Subject();\n  var streams = [];\n\n  var data = {};\n  var onDestroyCallback = function () {};\n  var intercept = pipe();\n\n  function updateData(obj) {\n    data = Object.assign({}, data, obj);\n  }\n\n  controller({\n    props$,\n    onDestroy: function (fn) {\n      if (fn) {\n        onDestroyCallback = fn;\n      }\n    },\n    resolve: function (strObj) {\n      const conf = toStreamArr(strObj || {});\n      streams = conf.streamProps;\n      data = conf.props;\n    },\n    setIntercept: function (i) {\n      if (i) {\n        intercept = i;\n      }\n    },\n  });\n\n  merge\n    .apply(null, [props$].concat(streams))\n    .pipe(takeUntil(destroyed$), map(updateData), intercept)\n    .subscribe(\n      function () {\n        force$.next();\n      },\n      function (e) {\n        throw e;\n      },\n      onDestroyCallback\n    );\n\n  return function (Wrapped) {\n    function StreamC() {\n      props$.next(arguments[0]);\n      React.Component.apply(this, arguments);\n    }\n\n    StreamC.prototype = Object.create(React.Component.prototype);\n\n    var sProto = StreamC.prototype;\n\n    sProto.constructor = StreamC;\n\n    sProto.componentDidMount = function () {\n      var self = this;\n      force$.pipe(takeUntil(destroyed$)).subscribe(function () {\n        self.forceUpdate();\n      });\n    };\n\n    sProto.componentWillUnmount = function () {\n      destroyed$.next();\n    };\n\n    sProto.shouldComponentUpdate = function (nextProps) {\n      if (!isShallowEqual(this.props, nextProps)) {\n        props$.next(nextProps);\n      }\n      return false;\n    };\n\n    sProto.render = function () {\n      return React.createElement(Wrapped, data);\n    };\n\n    return StreamC;\n  };\n}\n\nexport default rx;\n"],"names":["controller","force$","Subject","props$","BehaviorSubject","destroyed$","streams","data","onDestroyCallback","intercept","pipe","onDestroy","fn","resolve","strObj","streamObj","props","streamProps","conf","Object","keys","map","key","val","forEach","x","isObservable","push","y","setIntercept","i","merge","apply","concat","takeUntil","obj","assign","subscribe","next","e","Wrapped","StreamC","arguments","React.Component","this","sProto","prototype","create","constructor","componentDidMount","self","forceUpdate","componentWillUnmount","shouldComponentUpdate","nextProps","v","o","k1","k2","length","isShallowEqual","render","React.createElement"],"mappings":"4FAyCA,SAAYA,GACV,IAAIC,EAAS,IAAIC,UACbC,EAAS,IAAIC,kBAAgB,IAC7BC,EAAa,IAAIH,UACjBI,EAAU,GAEVC,EAAO,GACPC,EAAoB,aACpBC,EAAYC,SAsChB,OAhCAV,EAAW,CACTG,OAAAA,EACAQ,UAAW,SAAUC,GACfA,IACFJ,EAAoBI,IAGxBC,QAAS,SAAUC,GACjB,IA3DeC,EACfC,EACAC,EAyDMC,GA3DSH,EA2DUD,GAAU,GA1DnCE,EAAQ,GACRC,EAAc,GAClBE,OAAOC,KAAKL,GACTM,IAAI,SAAUC,GACb,MAAO,CAAEA,IAAAA,EAAKC,IAAKR,EAAUO,MAE9BE,QAAQ,SAAUC,GACbC,eAAaD,EAAEF,IAAIG,cACrBT,EAAYU,KACVF,EAAEF,IAAIb,KACJW,MAAI,SAAUO,GACZ,MAAO,EAAGH,EAAEH,KAAMM,OAKxBZ,EAAMS,EAAEH,KAAOG,EAAEF,MAGhB,CAAEP,MAAOA,EAAOC,YAAaA,IAwChCX,EAAUY,EAAKD,YACfV,EAAOW,EAAKF,OAEda,aAAc,SAAUC,GAClBA,IACFrB,EAAYqB,MAKlBC,QACGC,MAAM,KAAM,CAAC7B,GAAQ8B,OAAO3B,IAC5BI,KAAKwB,YAAU7B,GAAagB,MAzB/B,SAAoBc,GAClB5B,EAAOY,OAAOiB,OAAO,GAAI7B,EAAM4B,KAwBe1B,GAC7C4B,UACC,WACEpC,EAAOqC,QAET,SAAUC,GACR,MAAMA,GAER/B,GAGG,SAAUgC,GACf,SAASC,IACPtC,EAAOmC,KAAKI,UAAU,IACtBC,YAAgBX,MAAMY,KAAMF,WAK9B,IAAIG,EAFJJ,EAAQK,UAAY3B,OAAO4B,OAAOJ,YAAgBG,WA4BlD,OAxBAD,EAAOG,YAAcP,EAErBI,EAAOI,kBAAoB,WACzB,IAAIC,EAAON,KACX3C,EAAOS,KAAKwB,YAAU7B,IAAagC,UAAU,WAC3Ca,EAAKC,iBAITN,EAAOO,qBAAuB,WAC5B/C,EAAWiC,QAGbO,EAAOQ,sBAAwB,SAAUC,GAIvC,OAvFN,SAAwBC,EAAGC,GACzB,IAAIC,EAAKtC,OAAOC,KAAKmC,GACjBG,EAAKvC,OAAOC,KAAKoC,GACrB,GAAIC,EAAGE,SAAWD,EAAGC,OAArB,CAGA,IAAK,IAAI7B,EAAI,EAAGA,EAAI2B,EAAGE,OAAQ7B,IAC7B,GAAI0B,EAAEC,EAAG3B,MAAQyB,EAAEG,EAAG5B,IACpB,OAGJ,OAAO,GAyEE8B,CAAehB,KAAK5B,MAAOsC,IAC9BnD,EAAOmC,KAAKgB,IAEP,GAGTT,EAAOgB,OAAS,WACd,OAAOC,gBAAoBtB,EAASjC,IAG/BkC"}