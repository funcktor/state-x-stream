{"version":3,"file":"index.min.js","sources":["../src/index.js"],"sourcesContent":["/* eslint-disable */\nimport React from \"react\";\nimport { BehaviorSubject, pipe, Subject, isObservable, of } from \"rxjs\";\nimport { map, takeUntil, mergeAll } from \"rxjs/operators\";\n\nfunction internalizeKey(key) {\n  return function (val) {\n    return { [key]: val };\n  };\n}\n\nfunction parseInput(obj, streams, props) {\n  var keys = Object.keys(obj);\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var val = obj[key];\n    if (isObservable(val)) {\n      var newObs = val.pipe(map(internalizeKey(key)));\n      streams.push(newObs);\n    } else {\n      props[key] = val;\n    }\n  }\n}\n\nfunction isShallowEqual(v, o) {\n  var k1 = Object.keys(v);\n  var k2 = Object.keys(o);\n  if (k1.length !== k2.length) {\n    return false;\n  }\n  for (var i = 0; i < k1.length; i++) {\n    if (o[k1[i]] !== v[k2[i]]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction mergeObjTo(ob1, ob2) {\n  var result = {};\n  var keys1 = Object.keys(ob1);\n  var keys2 = Object.keys(ob2);\n  for (var i = 0; i < keys1.length; i++) {\n    result[keys1[i]] = ob1[keys1[i]];\n  }\n  for (var i = 0; i < keys2.length; i++) {\n    result[keys2[i]] = ob2[keys2[i]];\n  }\n  return result;\n}\n\nfunction xstream(controller, Wrapped) {\n  function StreamC() {\n    var self = this;\n    this.props$ = new BehaviorSubject(mergeObjTo({}, arguments[0]));\n    this.force$ = new Subject();\n    this.destroyed$ = new Subject();\n    this.streams = [];\n    this.resolved = {};\n\n    var intercept = pipe();\n\n    controller({\n      props$: self.props$,\n      destroyed$: self.destroyed$,\n      resolve: function (strObj) {\n        parseInput(strObj || {}, self.streams, self.resolved);\n      },\n      setIntercept: function (i) {\n        intercept = i;\n      },\n    });\n\n    function onSuccess() {\n      self.force$.next();\n    }\n\n    function onError(e) {\n      console.error(e);\n    }\n\n    var resolvedStreams = of.apply(null, self.streams).pipe(\n      mergeAll(),\n      map(function (obj) {\n        self.resolved = mergeObjTo(self.resolved, obj);\n      })\n    );\n\n    of.apply(null, [self.props$].concat(resolvedStreams))\n      .pipe(mergeAll(), takeUntil(self.destroyed$), intercept)\n      .subscribe(onSuccess, onError);\n\n    React.Component.apply(self, arguments);\n  }\n\n  StreamC.prototype = Object.create(React.Component.prototype);\n\n  var sProto = StreamC.prototype;\n\n  sProto.constructor = StreamC;\n\n  sProto.componentDidMount = function () {\n    var self = this;\n    self.force$.pipe(takeUntil(self.destroyed$)).subscribe(function () {\n      self.forceUpdate();\n    });\n  };\n\n  sProto.componentWillUnmount = function () {\n    this.destroyed$.next();\n  };\n\n  sProto.shouldComponentUpdate = function (nextProps) {\n    if (!isShallowEqual(this.props, nextProps)) {\n      this.props$.next(mergeObjTo(nextProps, {}));\n    }\n    return false;\n  };\n\n  sProto.render = function () {\n    var props = mergeObjTo(this.props$.value, this.resolved);\n    return React.createElement(Wrapped, props);\n  };\n\n  return StreamC;\n}\n\nexport default xstream;\n"],"names":["parseInput","obj","streams","props","keys","Object","i","length","newObs","key","val","isObservable","pipe","map","internalizeKey","push","mergeObjTo","ob1","ob2","result","keys1","keys2","controller","Wrapped","StreamC","self","this","props$","BehaviorSubject","arguments","force$","Subject","destroyed$","resolved","intercept","resolve","strObj","setIntercept","resolvedStreams","of","apply","mergeAll","concat","takeUntil","subscribe","next","e","console","error","React","Component","sProto","prototype","create","constructor","componentDidMount","forceUpdate","componentWillUnmount","shouldComponentUpdate","nextProps","v","o","k1","k2","isShallowEqual","render","value","createElement"],"mappings":"qKAWA,SAASA,EAAWC,EAAKC,EAASC,GAEhC,IADA,IAAIC,EAAOC,OAAOD,KAAKH,GACdK,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAAK,CACpC,IAGME,EAHFC,EAAML,EAAKE,GACXI,EAAMT,EAAIQ,GACVE,eAAaD,IACXF,EAASE,EAAIE,KAAKC,MAZ5B,SAAwBJ,GACtB,OAAO,SAAUC,GACf,MAAO,EAAGD,GAAMC,IAUYI,CAAeL,KACzCP,EAAQa,KAAKP,IAEbL,EAAMM,GAAOC,GAmBnB,SAASM,EAAWC,EAAKC,GAIvB,IAHA,IAAIC,EAAS,GACTC,EAAQf,OAAOD,KAAKa,GACpBI,EAAQhB,OAAOD,KAAKc,GACfZ,EAAI,EAAGA,EAAIc,EAAMb,OAAQD,IAChCa,EAAOC,EAAMd,IAAMW,EAAIG,EAAMd,IAE/B,IAASA,EAAI,EAAGA,EAAIe,EAAMd,OAAQD,IAChCa,EAAOE,EAAMf,IAAMY,EAAIG,EAAMf,IAE/B,OAAOa,YAGT,SAAiBG,EAAYC,GAC3B,SAASC,IACP,IAAIC,EAAOC,KACXA,KAAKC,OAAS,IAAIC,kBAAgBZ,EAAW,GAAIa,UAAU,KAC3DH,KAAKI,OAAS,IAAIC,UAClBL,KAAKM,WAAa,IAAID,UACtBL,KAAKxB,QAAU,GACfwB,KAAKO,SAAW,GAEhB,IAAIC,EAAYtB,SAEhBU,EAAW,CACTK,OAAQF,EAAKE,OACbK,WAAYP,EAAKO,WACjBG,QAAS,SAAUC,GACjBpC,EAAWoC,GAAU,GAAIX,EAAKvB,QAASuB,EAAKQ,WAE9CI,aAAc,SAAU/B,GACtB4B,EAAY5B,KAYhB,IAAIgC,EAAkBC,KAAGC,MAAM,KAAMf,EAAKvB,SAASU,KACjD6B,aACA5B,MAAI,SAAUZ,GACZwB,EAAKQ,SAAWjB,EAAWS,EAAKQ,SAAUhC,MAI9CsC,KAAGC,MAAM,KAAM,CAACf,EAAKE,QAAQe,OAAOJ,IACjC1B,KAAK6B,aAAYE,YAAUlB,EAAKO,YAAaE,GAC7CU,UAjBH,WACEnB,EAAKK,OAAOe,QAGd,SAAiBC,GACfC,QAAQC,MAAMF,KAchBG,UAAMC,UAAUV,MAAMf,EAAMI,WAK9B,IAAIsB,EAFJ3B,EAAQ4B,UAAY/C,OAAOgD,OAAOJ,UAAMC,UAAUE,WA6BlD,OAzBAD,EAAOG,YAAc9B,EAErB2B,EAAOI,kBAAoB,WACzB,IAAI9B,EAAOC,KACXD,EAAKK,OAAOlB,KAAK+B,YAAUlB,EAAKO,aAAaY,UAAU,WACrDnB,EAAK+B,iBAITL,EAAOM,qBAAuB,WAC5B/B,KAAKM,WAAWa,QAGlBM,EAAOO,sBAAwB,SAAUC,GAIvC,OA5FJ,SAAwBC,EAAGC,GACzB,IAAIC,EAAKzD,OAAOD,KAAKwD,GACjBG,EAAK1D,OAAOD,KAAKyD,GACrB,GAAIC,EAAGvD,SAAWwD,EAAGxD,OAArB,CAGA,IAAK,IAAID,EAAI,EAAGA,EAAIwD,EAAGvD,OAAQD,IAC7B,GAAIuD,EAAEC,EAAGxD,MAAQsD,EAAEG,EAAGzD,IACpB,OAGJ,OAAO,GA8EA0D,CAAetC,KAAKvB,MAAOwD,IAC9BjC,KAAKC,OAAOkB,KAAK7B,EAAW2C,EAAW,MAElC,GAGTR,EAAOc,OAAS,WACd,IAAI9D,EAAQa,EAAWU,KAAKC,OAAOuC,MAAOxC,KAAKO,UAC/C,OAAOgB,UAAMkB,cAAc5C,EAASpB,IAG/BqB"}